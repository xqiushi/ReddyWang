---
layout:     post
title:      解决路由端阿里DDNS失效的方法
subtitle:   阿里DDNS放在路由器里很好用
date:       2017-06-17
author:     xqiushi
header-img: img/post-bg-android.jpg
catalog: true
tags:
    - AliDDNS
    - 术
---



### 1.前言
现在倡导互联网+观念，我们享受着无尽的网络风暴。家庭网络带宽不断在增长，我就亲身经历过，2000年左右的网是256kb的拨号上网，到现在电信169套餐200M的下行。奇怪的是，游戏一样的打着，没有觉得256kb的有多，也没有觉得200M的有稳。

家庭网络功能需要开始多元化。而其他的类似物联网的概念也在走进家庭。比如，[小米空气净化器pro](https://union-click.jd.com/jdc?d=hVZ052),你根本不需要人到家后才打开。Dropbox不能用，国家的网盘也纷纷关闭，抑或是几个iPhone手机，iCloud的空间根本不够了(听说最近降价，但是速度永远是痛)，这是一个[家用NAS：群晖](https://union-click.jd.com/jdc?d=AbohoU)一步搞定所有。总之，现代是以网络技术为基础的共享社会。
### 2.路由和动态域名
说到网络，必须会想到一直硬件，那就是路由。简单的说，路由就是一个网络节点，让你的终端可以与其他服务器交换数据。
由此可见，他处于一个重要的位置。现在的路由也非常多的功能。无线中断，多wan均衡，访客模式，定时任务等功能，人们称为智能化路由。

众多功能中，不得不说就是动态域名解析。通过PPPoE拨号的路由真实身份是一个IPv4或IPv6的地址。而这个身份会周期性变化的。而动态域名的作用就是给你的路由定义一个唯一的名字，让别人叫名字就可以找到她，而不是用她的会变化的身高(IPv4)来找她。这样就可以让你的路由也在云端，变成物联网的一部分。只要能找得到路由，就可以找到联接该路由的一切产品。特别是那种模拟群晖的用户，通过特别的域名就可以在互联网上访问你的黑群晖。
### 3.阿里动态域名
以前的路由都集成了3322.org、花生壳等动态域名，虽然他们的解析速度还可能，但是总怕他不稳定。现在阿里云开放了API，技术宅们编译了一个动态域名的功能到路由，这样可以实现阿里的Accesskey的方式来将路由的动态ip与域名作A记录。访问域名里，就访问到路由，然后可以访问路由下的任务设备。

当然你要有阿里的帐号与域名。然后如步操作，申请Acceskey。
+ 找到申请位置：点击用户名位置，下拉中选择Accesskeys
![]()
+ 选择Accesskeys而不是RAM
![]()
+ 生成keyID 与 Secret
![]()
把上面的相关信息填到路由中，你就会看到A记录会更新了。

有时，PPPoE会自动更新几个IP，那么你得使用[云解析](https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=87drmbp6&amp;productCode=alidns&amp;utm_source=87drmbp6)来加速处理DNS缓存。
### 4.A记录更新失败
但是我用的aliDDNS这个东西，有时会失效，看记录明明说更新了IP，在阿里云里查看，却始终是原来的IP，这样会导致解析失败。

经粗略测试发现，有这样的情况会导致解析失败，
- 以前是更新子域名www，我后来想换成BLOG，但是，结果两个都更新不了。
- 阿里有两个域名，我想更换一下，更换后，两个都不能解析了。
- 路由死机重启后。

> 而这些问题的本质只有一个：record_id没有随你的变更而变化

这个值是你初次解析时，阿里云返回的一个认识码之类的，来对应你要修改的域名与子域名。
解析办法就是使用sftp工具登陆到路由中，清空etc/config/aliddns中，record_id和main_domain值，修改endable值为0。然后登陆到路由8080端口重启插件。如图：
![]()
### 5.小结
家庭云的确很方面，数据就在眼前，也很放心，而且域名解析到本路由，上传与下载的速度也差不多算是局域网速度。但是，有很多技术还是处于探索阶段，整体云系统有非常多的BUG，仍然需要计算机技术的支撑。